
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
        <meta name="author" content="Tobias Brock, Stefanie Schwarz, Anne Gritto">
      
      
      
        <link rel="prev" href="../ci/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.28">
    
    
      
        <title>Docker - MLOps Fake News Classification</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.6543a935.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#docker" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="MLOps Fake News Classification" class="md-header__button md-logo" aria-label="MLOps Fake News Classification" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            MLOps Fake News Classification
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Docker
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="MLOps Fake News Classification" class="md-nav__button md-logo" aria-label="MLOps Fake News Classification" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    MLOps Fake News Classification
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../setup/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Setup
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../run_local/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Model training
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ci/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Continuous Integration
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Docker
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Docker
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#about-docker" class="md-nav__link">
    <span class="md-ellipsis">
      About Docker
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#general-useful-commands" class="md-nav__link">
    <span class="md-ellipsis">
      General useful commands
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#local-docker" class="md-nav__link">
    <span class="md-ellipsis">
      Local Docker
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cloud-docker" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud Docker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cloud Docker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#images" class="md-nav__link">
    <span class="md-ellipsis">
      Images
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloudbuilds" class="md-nav__link">
    <span class="md-ellipsis">
      Cloudbuilds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#push-und-pull" class="md-nav__link">
    <span class="md-ellipsis">
      Push und pull
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#about-docker" class="md-nav__link">
    <span class="md-ellipsis">
      About Docker
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#general-useful-commands" class="md-nav__link">
    <span class="md-ellipsis">
      General useful commands
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#local-docker" class="md-nav__link">
    <span class="md-ellipsis">
      Local Docker
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cloud-docker" class="md-nav__link">
    <span class="md-ellipsis">
      Cloud Docker
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cloud Docker">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#images" class="md-nav__link">
    <span class="md-ellipsis">
      Images
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#cloudbuilds" class="md-nav__link">
    <span class="md-ellipsis">
      Cloudbuilds
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#push-und-pull" class="md-nav__link">
    <span class="md-ellipsis">
      Push und pull
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="docker">Docker</h1>
<p>Make sure to have <a href="https://docs.docker.com/desktop/install/windows-install/">Docker Desktop</a> installed. The data also needs to be accessed, either with your local data folder or via the data bucket in GCS.</p>
<h2 id="about-docker">About Docker</h2>
<p>A Docker image is a template for a Docker container. A Docker container is a running instance of a Docker image. A Docker image is a static file, while a Docker container is a running process. Running inside a Docker container gives you a consistent and independent environment for your application. This means that you can be sure that your application will run the same way on your machine as it will on another machine. Thus, Docker gives the ability to abstract away the differences between different machines.</p>
<h2 id="general-useful-commands">General useful commands</h2>
<pre><code class="language-bash">docker images               # list all images
docker rmi &lt;image_id&gt;       # remove a docker image
docker run                  # create a docker container
docker start &lt;container_id&gt; # restart docker container
docker stop &lt;container_id&gt;  # stop docker container
docker ps                   # list containers
docker rm &lt;container_id&gt;    # remove docker container
</code></pre>
<h2 id="local-docker">Local Docker</h2>
<p>To run a dockerfile locally, for example to train the model, type</p>
<pre><code class="language-bash"># Training
docker build -f docker/trainer_local.dockerfile . -t trainer:latest # creates a docker image
## Create Docker container with mounted models folder
docker run --name &lt;container_name&gt; -v %cd%/models:/models/ trainer:latest train.local_data=True train.local_wandb=True &lt;model.dropout_rate=0.3 train.batch_size=8&gt; # Windows command line
docker run --name &lt;container_name&gt; -v $(pwd)/models:/models/ trainer:latest # for Powershell/Linux
docker run --name &lt;container_name&gt; -v ${PWD}/models:/models/ trainer:latest # if something else does not work

# Predicting
docker build -f docker/predict_local.dockerfile . -t predict:latest
docker run --name &lt;container_name&gt; predict:latest predict.local_data=True predict.local_wandb=True
</code></pre>
<h2 id="cloud-docker">Cloud Docker</h2>
<p>Authentification for Docker with GCP: <code>gcloud auth configure-docker europe-west3.pkg.dev</code></p>
<h3 id="images">Images</h3>
<p>We use Cloud Build for building the containers in the cloud and Artifact registry for storing the images afterward. The latest image is automatically triggered when pushing code to main. We have 5 images in our Google Cloud <a href="https://console.cloud.google.com/artifacts/docker/mlops-fakenews/europe-west3/mlops-fakenews-container?project=mlops-fakenews">Artifact Registry</a>, <code>backend, frontend, monitoring, predict</code> and <code>trainer</code>.</p>
<h3 id="cloudbuilds">Cloudbuilds</h3>
<p>To build containers in the cloud from local, we use the <code>cloudbuild.yaml</code> which in our case builds the docker images of <code>trainer</code> and <code>predict</code> and pushes them to the Artifact registry.</p>
<pre><code class="language-bash">gcloud builds submit —-config=config/cloudbuild.yaml .            # for trainer and predict
gcloud builds submit —-config=config/cloudbuild_backend.yaml .    # builds, pushes and deploys
gcloud builds submit —-config=config/cloudbuild_frontend.yaml .   # builds, pushes and deploys
gcloud builds submit —-config=config/cloudbuild_monitoring.yaml . # builds, pushes and deploys
</code></pre>
<h3 id="push-und-pull">Push und pull</h3>
<p>To push and pull to our Artifact registry, we refer to this URL: <code>europe-west3-docker.pkg.dev/mlops-fakenews/mlops-fakenews-container</code>, e.g. to pull the latest trainer image, type</p>
<p><code>docker pull europe-west3-docker.pkg.dev/mlops-fakenews/mlops-fakenews-container/trainer:latest</code></p>
<p>Manually creating images &amp; push them, example with busybox:</p>
<pre><code class="language-bash">docker tag busybox &lt;region&gt;-docker.pkg.dev/&lt;project-id&gt;/&lt;registry-name&gt;/busybox:latest
docker push &lt;region&gt;-docker.pkg.dev/&lt;project-id&gt;/&lt;registry-name&gt;/busybox:latest
</code></pre>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": ["content.code.copy", "content.code.annotate"], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.fe8b6f2b.min.js"></script>
      
    
  </body>
</html>